{
  "version": "1.0.0",
  "templates": {
    "explore_codebase_context": {
      "name": "Explore Codebase Context",
      "description": "General codebase exploration for context gathering",
      "agent": "Explore",
      "model": "haiku",
      "prompt_template": "Explore the codebase to gather context for the following request:\n\n\"{user_prompt}\"\n\n## Your Task:\n\n1. **Find Relevant Files**\n   - Search for files related to: {keywords}\n   - Identify main components, controllers, services, or modules\n   - Note configuration files if relevant\n\n2. **Detect Patterns**\n   - Analyze file organization and naming conventions\n   - Identify code structure patterns (classes, functions, modules)\n   - Note common utilities or helpers\n\n3. **Find Similar Implementations**\n   - Look for existing code that does something similar\n   - Identify examples to follow or extend\n\n4. **Validate Technical Feasibility**\n   - Check if required dependencies exist\n   - Verify compatibility with current tech stack\n   - Identify any potential blockers\n\n5. **Provide Recommendations**\n   - Suggest the best approach based on codebase analysis\n   - Recommend specific files to modify or create\n   - Note any architectural considerations\n\n## Return Format:\n\nProvide a structured summary:\n\n```\n### Relevant Files Found\n- file1.ext - [description]\n- file2.ext - [description]\n\n### Patterns Detected\n- Naming: [pattern]\n- Structure: [pattern]\n- Organization: [pattern]\n\n### Similar Implementations\n- Example 1: [file] - [description]\n- Example 2: [file] - [description]\n\n### Technical Feasibility\nFeasible: [yes/no]\nBlockers: [list or \"None\"]\nRequired Dependencies: [list or \"All present\"]\n\n### Recommendations\n1. [First recommendation with reasoning]\n2. [Second recommendation with reasoning]\n\n### Suggested Approach\n[Detailed suggestion based on codebase analysis]\n```\n\nBe thorough but concise. Focus on actionable insights."
    },
    "validate_technical_feasibility": {
      "name": "Validate Technical Feasibility",
      "description": "Check if a proposed change is technically feasible",
      "agent": "Explore",
      "model": "haiku",
      "prompt_template": "Validate the technical feasibility of the following request:\n\n\"{user_prompt}\"\n\n## Validation Checklist:\n\n1. **Dependencies**\n   - Check if all required libraries/packages are installed\n   - Verify version compatibility\n   - Note any missing dependencies\n\n2. **Tech Stack Compatibility**\n   - Confirm request is compatible with current tech stack\n   - Check for framework constraints\n   - Identify any version-specific limitations\n\n3. **Architectural Conflicts**\n   - Look for conflicts with existing architecture\n   - Check if request violates established patterns\n   - Note any design principle violations\n\n4. **Similar Implementations**\n   - Find if similar features exist in codebase\n   - Check if there's prior art to learn from\n   - Identify reusable components\n\n5. **Resource Requirements**\n   - Estimate impact on database\n   - Note API/external service requirements\n   - Identify performance considerations\n\n## Return Format:\n\n```\n### Feasibility Assessment\n**Overall: [FEASIBLE / NOT FEASIBLE / FEASIBLE WITH CHANGES]**\n\n### Dependency Check\n- Required: [list]\n- Present: [list]\n- Missing: [list or \"None\"]\n\n### Compatibility Analysis\n- Tech Stack: [compatible/incompatible - details]\n- Framework: [compatible/incompatible - details]\n- Version: [compatible/incompatible - details]\n\n### Architectural Analysis\n- Conflicts: [list or \"None\"]\n- Pattern Alignment: [yes/no - details]\n- Design Principles: [aligned/violated - details]\n\n### Blockers\n[List critical blockers, or \"None\"]\n\n### Required Changes\n[List changes needed to make it feasible, or \"None\"]\n\n### Recommended Approach\n[Specific recommendation based on analysis]\n```\n\nBe precise and actionable."
    },
    "detect_patterns_and_conventions": {
      "name": "Detect Patterns and Conventions",
      "description": "Analyze codebase to find patterns to follow",
      "agent": "Explore",
      "model": "haiku",
      "prompt_template": "Analyze the codebase to detect patterns and conventions for:\n\n**Scope:** {scope}\n**Context:** {context}\n\n## Analysis Tasks:\n\n1. **File Organization**\n   - How are files structured?\n   - What's the directory naming convention?\n   - Where do different types of files live?\n\n2. **Naming Conventions**\n   - Class/Component naming patterns\n   - Function/Method naming patterns\n   - Variable naming patterns\n   - File naming patterns\n\n3. **Code Structure Patterns**\n   - Common architectural patterns (MVC, Repository, Service layer, etc.)\n   - How are concerns separated?\n   - Common code organization within files\n\n4. **Common Utilities**\n   - Shared helper functions\n   - Base classes or interfaces\n   - Common imports or dependencies\n\n5. **Best Examples**\n   - Find 2-3 well-implemented examples of similar code\n   - Note what makes them good examples\n\n## Return Format:\n\n```\n### File Organization Pattern\n- Directory structure: [description]\n- File placement rules: [description]\n- Example: [path/to/example]\n\n### Naming Conventions\n- Classes/Components: [pattern with examples]\n- Functions/Methods: [pattern with examples]\n- Variables: [pattern with examples]\n- Files: [pattern with examples]\n\n### Code Structure Pattern\n- Architecture: [pattern name and description]\n- Separation of Concerns: [how it's done]\n- Common Structure: [typical file structure]\n\n### Common Utilities Found\n- [utility1]: [file] - [purpose]\n- [utility2]: [file] - [purpose]\n\n### Best Practice Examples\n1. [file1] - [why it's a good example]\n2. [file2] - [why it's a good example]\n3. [file3] - [why it's a good example]\n\n### Recommended Structure for New Code\n```\n[Suggested file structure matching detected patterns]\n```\n\n### Pattern Summary\n[Concise summary of key patterns to follow]\n```\n\nFocus on actionable patterns that can be immediately applied."
    },
    "plan_implementation": {
      "name": "Plan Implementation Strategy",
      "description": "Create implementation plan for complex tasks",
      "agent": "Plan",
      "model": "sonnet",
      "prompt_template": "Create a detailed implementation plan for:\n\n\"{user_prompt}\"\n\n## Planning Objectives:\n\n1. **Understand Requirements**\n   - Break down what needs to be built\n   - Identify dependencies between components\n   - Note any constraints\n\n2. **Analyze Existing Code**\n   - Find relevant existing implementations\n   - Identify reusable components\n   - Note patterns to follow\n\n3. **Design Approach**\n   - Propose 2-3 implementation options\n   - Compare trade-offs\n   - Recommend best approach\n\n4. **Implementation Steps**\n   - Create ordered, actionable steps\n   - Identify files to create/modify\n   - Note testing requirements\n\n5. **Risk Assessment**\n   - Identify potential issues\n   - Suggest mitigation strategies\n\n## Return Format:\n\n```\n### Requirements Analysis\n[Breakdown of what needs to be built]\n\n### Existing Code Analysis\n- Relevant files: [list]\n- Reusable components: [list]\n- Patterns to follow: [description]\n\n### Implementation Options\n\n**Option 1: [Name]**\nPros:\n- [pro 1]\n- [pro 2]\nCons:\n- [con 1]\n- [con 2]\nComplexity: [Low/Medium/High]\n\n**Option 2: [Name]**\nPros:\n- [pro 1]\n- [pro 2]\nCons:\n- [con 1]\n- [con 2]\nComplexity: [Low/Medium/High]\n\n**â­ Recommended: Option [X]**\nReasoning: [why this is best]\n\n### Implementation Plan\n\n**Phase 1: [Phase Name]**\n1. [Step 1 with file references]\n2. [Step 2 with file references]\n\n**Phase 2: [Phase Name]**\n1. [Step 1 with file references]\n2. [Step 2 with file references]\n\n**Phase 3: Testing & Validation**\n1. [Testing steps]\n2. [Validation steps]\n\n### Files to Create/Modify\n- `path/to/file1.ext` - [what changes]\n- `path/to/file2.ext` - [what changes]\n\n### Risk Assessment\n**Potential Issues:**\n1. [Issue 1] - Mitigation: [strategy]\n2. [Issue 2] - Mitigation: [strategy]\n\n### Success Criteria\n- [Criterion 1]\n- [Criterion 2]\n\n### Estimated Complexity\n[Overall complexity assessment with reasoning]\n```\n\nProvide detailed, actionable guidance."
    },
    "lead_agent_orchestrator": {
      "name": "Lead Agent Orchestrator",
      "description": "Coordinates multi-agent research with iteration management",
      "agent": "LeadAgent",
      "model": "sonnet",
      "prompt_template": "Coordinate multi-agent research for:\n\n\"{user_prompt}\"\n\n**Research Scope:** {scope}\n**Strategy:** {strategy}\n**Focus Areas:** {focus_areas}\n\n## Your Orchestration Responsibilities:\n\n1. **Load External Memory**\n   - Read project-knowledge.md for existing knowledge\n   - Read architectural-context.md for system understanding\n   - Identify gaps that need research\n\n2. **Plan Agent Cohort**\n   - Select 2-5 specialized agents based on focus areas\n   - Always include: ExploreAgent, CitationAgent\n   - Conditionally include: SecurityAgent, PerformanceAgent, PatternAgent\n\n3. **Coordinate Iterations**\n   - Monitor coverage and confidence across iterations\n   - Identify gaps for refinement\n   - Decide when research has converged\n\n4. **Invoke Result Aggregator**\n   - When convergence is met, trigger aggregation\n   - Ensure all findings are properly synthesized\n\nRefer to: .claude/library/orchestration/lead-agent-core.md"
    },
    "security_audit_specialist": {
      "name": "Security Audit Specialist",
      "description": "Comprehensive security vulnerability detection and OWASP analysis",
      "agent": "Security",
      "model": "sonnet",
      "prompt_template": "Perform security audit for:\n\n\"{user_prompt}\"\n\n**Scope:** {scope}\n**Focus:** Security vulnerabilities, authentication, authorization, data protection\n\n## Your Security Analysis Tasks:\n\n1. **OWASP Top 10 Compliance**\n   - Check each OWASP category\n   - Identify vulnerabilities\n   - Assess severity (Critical/High/Medium/Low)\n\n2. **Authentication Analysis**\n   - Password hashing (BCrypt, Argon2, etc.)\n   - Token management (JWT, sessions)\n   - MFA implementation\n\n3. **Authorization Analysis**\n   - Role-based access control\n   - Privilege escalation risks\n   - Endpoint protection\n\n4. **Data Protection**\n   - Encryption at rest and in transit\n   - Sensitive data handling\n   - Secrets management\n\n5. **Provide Severity Ratings**\n   - Use CVSS scores where applicable\n   - Prioritize findings (Critical > High > Medium > Low)\n\nRefer to: .claude/library/agents/security-agent.md"
    },
    "performance_analysis_specialist": {
      "name": "Performance Analysis Specialist",
      "description": "Bottleneck detection and optimization opportunity identification",
      "agent": "Performance",
      "model": "sonnet",
      "prompt_template": "Analyze performance for:\n\n\"{user_prompt}\"\n\n**Scope:** {scope}\n**Focus:** Bottlenecks, N+1 queries, caching, async patterns\n\n## Your Performance Analysis Tasks:\n\n1. **Database Performance**\n   - Detect N+1 query patterns\n   - Identify missing indexes\n   - Find inefficient queries\n\n2. **Caching Analysis**\n   - Identify cacheable data\n   - Validate cache usage\n   - Recommend caching strategies\n\n3. **Async/Await Patterns**\n   - Detect blocking operations (.Result, .Wait())\n   - Validate async usage\n   - Recommend async improvements\n\n4. **Resource Management**\n   - Memory leak detection\n   - Connection pooling review\n   - Disposable pattern validation\n\n5. **Estimate Impact**\n   - Provide performance improvement estimates (2x, 10x, 50x)\n   - Prioritize by impact (Critical: 50x+, Important: 10-50x, Info: <10x)\n\nRefer to: .claude/library/agents/performance-agent.md"
    },
    "pattern_detection_specialist": {
      "name": "Pattern Detection Specialist",
      "description": "Code pattern and convention detection for consistency analysis",
      "agent": "Pattern",
      "model": "haiku",
      "prompt_template": "Detect patterns and conventions for:\n\n\"{user_prompt}\"\n\n**Scope:** {scope}\n**Focus:** Naming conventions, file organization, architectural patterns, code style\n\n## Your Pattern Analysis Tasks:\n\n1. **Naming Conventions**\n   - Interfaces: [Pattern] (e.g., I{Name})\n   - Classes: [Pattern] (e.g., {Entity}{Purpose})\n   - Methods: [Pattern] (e.g., {Verb}{Noun}Async)\n   - Variables: [Pattern] (e.g., camelCase)\n   - Calculate consistency scores (% adherence)\n\n2. **File Organization**\n   - Directory structure patterns\n   - File placement rules\n   - One class per file?\n\n3. **Architectural Patterns**\n   - Repository pattern\n   - Service layer\n   - Dependency injection\n   - Factory pattern\n   - Other patterns detected\n\n4. **Code Style**\n   - Error handling patterns\n   - Validation patterns\n   - Logging patterns\n\n5. **Provide Consistency Scores**\n   - Calculate % adherence for each pattern\n   - Flag outliers\n   - Recommend corrections\n\nRefer to: .claude/library/agents/pattern-agent.md"
    },
    "citation_specialist": {
      "name": "Citation Specialist",
      "description": "Source attribution with file:line precision and code snippets",
      "agent": "Citation",
      "model": "haiku",
      "prompt_template": "Provide citations for findings from:\n\n\"{research_scope}\"\n\n**Findings to Cite:** {findings_count}\n\n## Your Citation Tasks:\n\n1. **Extract Source Locations**\n   - File path (absolute)\n   - Line numbers (exact range)\n   - Code snippets (5 lines context before/after)\n\n2. **Confidence Scoring**\n   - Direct evidence: 0.90\n   - Supporting evidence: 0.75\n   - Indirect evidence: 0.60\n   - Inference: 0.50\n\n3. **Citation Format**\n   - [ID] File:Lines\n   - Code snippet with line numbers\n   - Evidence type\n   - Confidence contribution\n\n4. **Cross-Reference**\n   - Link to knowledge graph\n   - Link to architectural context\n   - Link to related findings\n\n5. **Update Citation Index**\n   - Add to .claude/memory/citation-index.md\n   - Include all metadata\n\nRefer to: .claude/library/agents/citation-agent.md"
    }
  },
  "trigger_mappings": {
    "architecture_question": "explore_codebase_context",
    "pattern_detection": "detect_patterns_and_conventions",
    "feasibility_check": "validate_technical_feasibility",
    "implementation_planning": "plan_implementation",
    "multi_file_scope": "explore_codebase_context",
    "cross_cutting_concerns": "explore_codebase_context",
    "refactoring_task": "plan_implementation",
    "security_audit": "security_audit_specialist",
    "performance_investigation": "performance_analysis_specialist",
    "architecture_analysis": "lead_agent_orchestrator",
    "pattern_discovery": "pattern_detection_specialist",
    "codebase_exploration": "lead_agent_orchestrator",
    "technical_debt_assessment": "lead_agent_orchestrator",
    "compliance_review": "security_audit_specialist"
  }
}
